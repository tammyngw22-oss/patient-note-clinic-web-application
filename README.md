# Patient Note Web Application

## 1. Project Overview / Motivation
### Problem: Fragmented Medical Records
*   **Chat-like Chaos**: Current timelines resemble disjointed chat logs, making it hard to find key info.
*   **No Unified Narrative**: Information is scattered across different stakeholders without a shared story.
*   **Hard to Spot Changes**: "What changed?" and differential analysis are difficult to perform quickly.
*   **Siloed Collaboration**: Lack of lightweight collaboration tools between Clinicians, Staff, and Patients.

### Goal: Longitudinal Patient Note App
*   **Collaboration**: Supports seamless interaction between Clinician, Staff, and Patient roles.
*   **AI-Scribed Notes**: Simulates AI generation of consult summaries to reduce administrative burden.
*   **Glance View**: Provides a "At-a-Glance" summary of key signals and actionable items.
*   **Shared Context**: Builds a continuous, longitudinal narrative for better patient care.

## 2. Installation & Run Instructions

### System Requirements
*   Python 3.x
*   Flask and other dependencies (see `requirements.txt`)

### Installation
1.  **Navigate to project directory**:
    ```bash
    cd "patient note clinic web application"
    ```
2.  **Create virtual environment**:
    ```bash
    python3 -m venv venv
    ```
3.  **Activate virtual environment**:
    *   Mac/Linux: `source venv/bin/activate`
    *   Windows: `venv\Scripts\activate`
4.  **Install dependencies**:
    ```bash
    pip install -r backend/requirements.txt
    ```

### Running the Backend
*   **Start the server**:
    ```bash
    # Option 1: Helper script
    sh start.sh
    
    # Option 2: Manual
    ./venv/bin/python backend/app.py
    ```
*   **Local Demo**: Runs on HTTP by default (see Privacy section for TLS).
*   **Data**: Uses synthetic data generated by `generate_synthetic_data.py`.

### Running the Frontend
*   The frontend is served directly by the Flask backend at `http://localhost:5001`.
*   Simply open your browser to the local URL.

## 3. RBAC & Access Control
### Server-Side Enforcement
Role-Based Access Control (RBAC) is strictly enforced on the backend.
*   **Patient**: 
    *   Can see: Patient-facing summaries, AI patient session summaries.
    *   Cannot see: Clinician notes, Staff notes, AI Nurse/Doctor consult summaries.
*   **Staff**: 
    *   Can see: Staff notes, AI Nurse consult summaries, AI Patient session summaries.
    *   Cannot see: Private Clinician notes.
*   **Clinician**: 
    *   Can see: All notes (Staff, AI-scribed, Patient inputs).
*   **Admin**: 
    *   Clinic-scoped oversight; can view and audit all entries.

*Note: The frontend UI adapts to the selected role for demonstration, but the security guarantee lies in the backend API filtering.*

## 4. PHI Redaction / Privacy
### Synthetic Data Only
*   All data used in this prototype is synthetic.

### Redaction Pipeline
*   **Mechanism**: Before sending any text to an LLM, a redaction pipeline runs.
*   **Targets**: Names, IC/ID numbers, Phone numbers, Email addresses.
*   **Replacement**: Sensitive data is replaced with tokens like `<REDACTED_ID>`.

### Data Security
*   **Encryption at Rest**: Data stored in `backend/note.json` is encrypted using Fernet (symmetric encryption).
*   **TLS in Transit**: 
    *   Production: HTTPS/TLS is required.
    *   Local Demo: Defaults to HTTP for ease of setup, but code supports TLS configuration.

## 5. AI-scribed Notes (Simulated)
### Supported Sources
*   **ai_doctor_consult_summary**: Summary of doctor-patient interaction.
*   **ai_nurse_consult_summary**: Summary of nurse instructions/triage.
*   **ai_patient_session_summary**: Summary accessible to the patient.

### Features
*   **Timeline Integration**: Appears as a distinct entry with `author_role=system` and a provenance pointer to the source event.
*   **Glance View**: Latest AI highlights are surfaced in the side panel.
*   **Role-Aware Filtering**: Different roles see different AI-generated content (e.g., Patients don't see technical medical jargon intended for Clinicians).

## 6. Glance View & Key Signals / Actions
### AI Highlights
*   Automatically surfaces key medical signals (risks, vitals) from the timeline.
*   Simulated via AI analysis of note content.

### Action Management
*   **Workflow**:
    *   **Doctor -> Staff**: "Need Lab Order", "Need Help from Nurse".
    *   **Staff -> Doctor**: "Request Clinician Review", "Follow-up with Patient".
*   **Navigation**: Clicking an Action jumps directly to the relevant context in the Timeline.
*   **Status Tracking**: Actions are marked `unresolved` or `resolved` and tracked in the Side Panel.

## 7. Data Decay / Historical Context
### Information Lifecycle
*   **Audit Trail**: Old data is never deleted, ensuring a complete audit history.
*   **Relevance Decay**: In Glance View, items are sorted by relevance, which decays over time.
*   **Summarization**: Older detailed notes can be compressed into AI-scribed summaries to reduce cognitive load (noise) in the interface.

## 8. Synthetic Data & Simulation
### Purpose
*   Demonstrates AI capabilities without exposing real patient data.
*   **Provenance**: Every AI note links back to its source data.
*   **Risk Reasons**: Highlights include short explanations (e.g., "Hypoxia risk") generated by the system.

## 9. System Architecture & Demo Configuration

*   **Hybrid AI Integration**: The system is fully architected to support real-time generative AI analysis (via Google Gemini API).
*   **Demonstration Mode**: For the purpose of this demo, the system is configured to use **High-Fidelity Synthetic Data**. This design choice ensures zero-latency performance and stability during presentation, bypassing external API rate limits while fully demonstrating the application's logical workflows and data handling capabilities.
*   **Role-Specific Design**: Feature availability is intentionally scoped by user role. For instance, the "Glance View" is exclusive to Clinicians and Staff to optimize professional workflows, while the Patient view remains streamlined by design.
